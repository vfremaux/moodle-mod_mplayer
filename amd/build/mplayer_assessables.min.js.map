{"version":3,"sources":["../src/mplayer_assessables.js"],"names":["define","$","log","cfg","modmplayerassessables","ismarking","currentzone","startpoint","startpointtime","endpoint","endpointtime","init","bind","bump_in","start_marking","debug","that","mplayerid","attr","replace","flowp","flowpclasses","matches","match","clipid","parseInt","newsegment","removeClass","css","off","stop_marking","addClass","url","wwwroot","get","delete_zone","parts","split","zoneid","remove","data","matched","mpid","index","html","progressbar","counter","window"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n// jshint unused: true, undef:true\n\ndefine(['jquery', 'core/log', 'core/config'], function($, log, cfg) {\n\n    var modmplayerassessables = {\n\n        ismarking: false,\n        currentzone: null,\n        startpoint: 0,\n        startpointtime: 0,\n        endpoint: 0,\n        endpointtime: 0,\n\n        init: function() {\n            $('.mplayer-bumper').bind('click', this.bump_in);\n            $('.mplayer-punchinout').bind('click', this.start_marking);\n\n            log.debug(\"AMD Mplayer Asessables initialized\");\n        },\n\n        // When a student starts marking a zone for himself.\n        // Start marking\n        start_marking: function() {\n\n            var that = $(this);\n            var mplayerid = that.attr('id').replace('mplayer-punchinout-', '');\n\n            // Get clip from associated flowplayer.\n            var flowp = $('#flp' + mplayerid);\n            var flowpclasses = flowp.attr('class');\n            var matches = flowpclasses.match(/video([0-9]+)/);\n            var clipid = 0 + parseInt(matches[1]);\n\n            // Reveal new zone div and attach to current marking context.\n            var mplayerclasses = ' .mod-mplayer-progressbar-outer .progressbar-segment.newzone';\n            var newsegment = $('#mplayer-progress-' + mplayerid + '_' + clipid + mplayerclasses);\n            var insertleft = 0;\n            $(newsegment).removeClass('is-hidden');\n            $(newsegment).css('left', insertleft + '%');\n            modmplayerassessables.currentzone = newsegment;\n            modmplayerassessables.ismarking = true;\n\n            $('#mplayer-punchinout-' + mplayerid).attr('value', \"Stop marking zone\");\n            $('#mplayer-punchinout-' + mplayerid).css('background-color', \"red\");\n            $('#mplayer-punchinout-' + mplayerid).css('color', \"white\");\n\n            // Rebind event for stop recording.\n            $('#mplayer-punchinout-' + mplayerid).off('click');\n            $('#mplayer-punchinout-' + mplayerid).bind('click', modmplayerassessables.stop_marking);\n            $('#mplayer-punchinout-' + mplayerid).addClass('is-marking');\n        },\n\n        // When a student stops marking a zone for himself.\n        stop_marking: function() {\n\n            var that = $(this);\n            var mplayerid = that.attr('id').replace('mplayer-punchinout-', '');\n\n            // Get clip from associated flowplayer.\n            var flowp = $('#flp' + mplayerid);\n            var flowpclasses = flowp.attr('class');\n            var matches = flowpclasses.match(/video([0-9]+)/);\n            var clipid = 0 + parseInt(matches[1]);\n\n            $('#mplayer-punchinout-' + mplayerid).attr('value', \"Start marking zone\");\n            $('#mplayer-punchinout-' + mplayerid).css('background-color', \"initial\");\n            $('#mplayer-punchinout-' + mplayerid).css('color', \"black\");\n\n            var url = cfg.wwwroot + '/mod/mplayer/pro/ajax/services.php?';\n            url += 'what=addzone';\n            url += '&mplayerid=' + mplayerid;\n            url += '&clipid=' + clipid;\n            url += '&startpoint=' + modmplayerassessables.startpoint;\n            url += '&endpoint=' + modmplayerassessables.endpoint;\n            url += '&startpointtime=' + modmplayerassessables.startpointtime;\n            url += '&endpointtime=' + modmplayerassessables.endpointtime;\n\n            // get a new zone id on recoding.\n            $.get(url, function() {\n            }, 'json');\n\n            var mplayerclasses = ' .mod-mplayer-progressbar-outer .progressbar-segment.newzone';\n            var newsegment = $('#mplayer-progress-' + mplayerid + '_' + clipid + mplayerclasses);\n            newsegment.addClass('is-hidden');\n\n            modmplayerassessables.ismarking = false;\n            modmplayerassessables.startpoint = modmplayerassessables.endpoint;\n            $('#mplayer-punchinout-' + mplayerid).off('click');\n            $('#mplayer-punchinout-' + mplayerid).bind('click', modmplayerassessables.start_marking);\n            $('#mplayer-punchinout-' + mplayerid).removeClass('is-marking');\n        },\n\n        // When a student deletes a zone he has marked\n        delete_zone: function() {\n\n            var that = $(this);\n            var parts = that.attr('data-zone').split('-');\n            var mplayerid = parts[0];\n            var clipid = parts[1];\n            var zoneid = parts[2];\n\n            var url = cfg.wwwroot + '/mod/mplayer/pro/ajax/services.php?';\n            url += '&what=deletezone';\n            url += '&mplayerid=' + mplayerid;\n            url += '&clipid=' + clipid;\n            url += '&zoneid=' + zoneid;\n\n            $.get(url, function() {\n                // Remove zone marking on screen.\n                $('body').remove('#' + that.attr('id'));\n            }, 'json');\n        },\n\n        // When a student bumps in a zone to discover it.\n        bump_in: function() {\n\n            var that = $(this);\n            var mplayerid = that.attr('id').replace('mplayer-bumper-', '');\n\n            // Get clip from associated flowplayer.\n            var flowp = $('#flp' + mplayerid);\n            var flowpclasses = flowp.attr('class');\n            var matches = flowpclasses.match(/video([0-9]+)/);\n            var clipid = 0 + parseInt(matches[1]);\n\n            var url = cfg.wwwroot + '/mod/mplayer/pro/ajax/services.php?';\n            url += 'what=bumpzone';\n            url += '&mplayerid=' + mplayerid;\n            url += '&clipid=' + clipid;\n            url += '&progress=' + modmplayerassessables.startpoint;\n            url += '&progresstime=' + modmplayerassessables.startpointtime;\n\n            $.get(url, function(data) {\n                if (data.matched == 'true') {\n                    $('#mplayer-progress-' + data.mpid + '_' + data.index).html(data.progressbar);\n                    $('#mplayer-assess-counts-' + data.mpid + '_' + data.index).html(data.counter);\n                }\n            }, 'json');\n        },\n    };\n\n    // globalize for completion scripts.\n    window.modmplayerassessables = modmplayerassessables;\n    return modmplayerassessables;\n});\n"],"file":"mplayer_assessables.min.js"}
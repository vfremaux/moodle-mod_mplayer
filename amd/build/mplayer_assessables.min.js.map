{"version":3,"file":"mplayer_assessables.min.js","sources":["../src/mplayer_assessables.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n// jshint unused: true, undef:true\n\ndefine(['jquery', 'core/log', 'core/config'], function($, log, cfg) {\n\n    var modmplayerassessables = {\n\n        ismarking: false,\n        currentzone: null,\n        startpoint: 0,\n        startpointtime: 0,\n        endpoint: 0,\n        endpointtime: 0,\n\n        init: function() {\n            $('.mplayer-bumper').bind('click', this.bump_in);\n            $('.mplayer-punchinout').bind('click', this.start_marking);\n\n            log.debug(\"AMD Mplayer Asessables initialized\");\n        },\n\n        // When a student starts marking a zone for himself.\n        // Start marking\n        start_marking: function() {\n\n            var that = $(this);\n            var mplayerid = that.attr('id').replace('mplayer-punchinout-', '');\n\n            // Get clip from associated flowplayer.\n            var flowp = $('#flp' + mplayerid);\n            var flowpclasses = flowp.attr('class');\n            var matches = flowpclasses.match(/video([0-9]+)/);\n            var clipid = 0 + parseInt(matches[1]);\n\n            // Reveal new zone div and attach to current marking context.\n            var mplayerclasses = ' .mod-mplayer-progressbar-outer .progressbar-segment.newzone';\n            var newsegment = $('#mplayer-progress-' + mplayerid + '_' + clipid + mplayerclasses);\n            var insertleft = 0;\n            $(newsegment).removeClass('is-hidden');\n            $(newsegment).css('left', insertleft + '%');\n            modmplayerassessables.currentzone = newsegment;\n            modmplayerassessables.ismarking = true;\n\n            $('#mplayer-punchinout-' + mplayerid).attr('value', \"Stop marking zone\");\n            $('#mplayer-punchinout-' + mplayerid).css('background-color', \"red\");\n            $('#mplayer-punchinout-' + mplayerid).css('color', \"white\");\n\n            // Rebind event for stop recording.\n            $('#mplayer-punchinout-' + mplayerid).off('click');\n            $('#mplayer-punchinout-' + mplayerid).bind('click', modmplayerassessables.stop_marking);\n            $('#mplayer-punchinout-' + mplayerid).addClass('is-marking');\n        },\n\n        // When a student stops marking a zone for himself.\n        stop_marking: function() {\n\n            var that = $(this);\n            var mplayerid = that.attr('id').replace('mplayer-punchinout-', '');\n\n            // Get clip from associated flowplayer.\n            var flowp = $('#flp' + mplayerid);\n            var flowpclasses = flowp.attr('class');\n            var matches = flowpclasses.match(/video([0-9]+)/);\n            var clipid = 0 + parseInt(matches[1]);\n\n            $('#mplayer-punchinout-' + mplayerid).attr('value', \"Start marking zone\");\n            $('#mplayer-punchinout-' + mplayerid).css('background-color', \"initial\");\n            $('#mplayer-punchinout-' + mplayerid).css('color', \"black\");\n\n            var url = cfg.wwwroot + '/mod/mplayer/pro/ajax/services.php?';\n            url += 'what=addzone';\n            url += '&mplayerid=' + mplayerid;\n            url += '&clipid=' + clipid;\n            url += '&startpoint=' + modmplayerassessables.startpoint;\n            url += '&endpoint=' + modmplayerassessables.endpoint;\n            url += '&startpointtime=' + modmplayerassessables.startpointtime;\n            url += '&endpointtime=' + modmplayerassessables.endpointtime;\n\n            // get a new zone id on recoding.\n            $.get(url, function() {\n            }, 'json');\n\n            var mplayerclasses = ' .mod-mplayer-progressbar-outer .progressbar-segment.newzone';\n            var newsegment = $('#mplayer-progress-' + mplayerid + '_' + clipid + mplayerclasses);\n            newsegment.addClass('is-hidden');\n\n            modmplayerassessables.ismarking = false;\n            modmplayerassessables.startpoint = modmplayerassessables.endpoint;\n            $('#mplayer-punchinout-' + mplayerid).off('click');\n            $('#mplayer-punchinout-' + mplayerid).bind('click', modmplayerassessables.start_marking);\n            $('#mplayer-punchinout-' + mplayerid).removeClass('is-marking');\n        },\n\n        // When a student deletes a zone he has marked\n        delete_zone: function() {\n\n            var that = $(this);\n            var parts = that.attr('data-zone').split('-');\n            var mplayerid = parts[0];\n            var clipid = parts[1];\n            var zoneid = parts[2];\n\n            var url = cfg.wwwroot + '/mod/mplayer/pro/ajax/services.php?';\n            url += '&what=deletezone';\n            url += '&mplayerid=' + mplayerid;\n            url += '&clipid=' + clipid;\n            url += '&zoneid=' + zoneid;\n\n            $.get(url, function() {\n                // Remove zone marking on screen.\n                $('body').remove('#' + that.attr('id'));\n            }, 'json');\n        },\n\n        // When a student bumps in a zone to discover it.\n        bump_in: function() {\n\n            var that = $(this);\n            var mplayerid = that.attr('id').replace('mplayer-bumper-', '');\n\n            // Get clip from associated flowplayer.\n            var flowp = $('#flp' + mplayerid);\n            var flowpclasses = flowp.attr('class');\n            var matches = flowpclasses.match(/video([0-9]+)/);\n            var clipid = 0 + parseInt(matches[1]);\n\n            var url = cfg.wwwroot + '/mod/mplayer/pro/ajax/services.php?';\n            url += 'what=bumpzone';\n            url += '&mplayerid=' + mplayerid;\n            url += '&clipid=' + clipid;\n            url += '&progress=' + modmplayerassessables.startpoint;\n            url += '&progresstime=' + modmplayerassessables.startpointtime;\n\n            $.get(url, function(data) {\n                if (data.matched == 'true') {\n                    $('#mplayer-progress-' + data.mpid + '_' + data.index).html(data.progressbar);\n                    $('#mplayer-assess-counts-' + data.mpid + '_' + data.index).html(data.counter);\n                }\n            }, 'json');\n        },\n    };\n\n    // globalize for completion scripts.\n    window.modmplayerassessables = modmplayerassessables;\n    return modmplayerassessables;\n});\n"],"names":["define","$","log","cfg","modmplayerassessables","ismarking","currentzone","startpoint","startpointtime","endpoint","endpointtime","init","bind","this","bump_in","start_marking","debug","mplayerid","attr","replace","matches","match","clipid","parseInt","newsegment","removeClass","css","insertleft","off","stop_marking","addClass","url","wwwroot","get","delete_zone","that","parts","split","zoneid","remove","data","matched","mpid","index","html","progressbar","counter","window"],"mappings":"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"}
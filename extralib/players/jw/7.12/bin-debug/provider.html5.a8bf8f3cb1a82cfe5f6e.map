{"version":3,"sources":["webpack:///./src/js/providers/html5.js","webpack:///./src/js/providers/data-normalizer.js","webpack:///./src/js/providers/tracks-mixin.js","webpack:///./src/js/utils/time-ranges.js"],"names":["getIsAndroidHLS","cssUtils","utils","dom","_","events","states","DefaultProvider","Events","Tracks","timeRangesUtil","clearTimeout","window","STALL_DELAY","MIN_DVR_DURATION","_isIE","isIE","_isIE9","_isMobile","isMobile","_isFirefox","isFF","_isAndroid","isAndroidNative","_isIOS7","isIOS","_isIOS8","_name","_setupListeners","eventsHash","videoTag","foreach","evt","evtCallback","addEventListener","_removeListeners","removeEventListener","VideoProvider","_playerId","_playerConfig","state","IDLE","seeking","extend","renderNatively","renderCaptionsNatively","configRenderNatively","isSafari","isEdge","isChrome","_this","_mediaEvents","click","_clickHandler","durationchange","_durationChangeHandler","ended","_endedHandler","error","_errorHandler","loadstart","_onLoadStart","loadeddata","_onLoadedData","loadedmetadata","_loadedMetadataHandler","canplay","_canPlayHandler","play","_loading","playing","_playingHandler","progress","_progressHandler","pause","_pauseHandler","_seekingHandler","seeked","_seekedHandler","timeupdate","_timeUpdateHandler","ratechange","_playbackRateHandler","volumechange","_volumeChangeHandler","webkitbeginfullscreen","_fullscreenBeginHandler","webkitendfullscreen","_fullscreenEndHandler","_container","_duration","_position","_canSeek","_bufferFull","_delayedSeek","_seekOffset","_playbackTimeout","_buffered","_levels","_currentQuality","_isAndroidHLS","_isSDK","sdkplatform","_fullscreenState","_beforeResumeHandler","noop","_audioTracks","_currentAudioTrackIndex","_visualQuality","level","_staleStreamDuration","_staleStreamTimeout","_lastEndOfBuffer","_stale","_edgeOfLiveStream","element","document","getElementById","_videotag","querySelector","undefined","_setAttribute","name","value","setAttribute","createElement","load","className","isSDK","video","supportsPlaybackRate","_setAudioTracks","audioTracks","setTextTracks","textTracks","trigger","_updateDuration","_getDuration","_setBuffered","_getBuffer","STALLED","setState","PLAYING","setTimeout","_checkPlaybackStalled","duration","Infinity","currentTime","_setPosition","JWPLAYER_MEDIA_TIME","position","_checkVisualQuality","playbackRate","width","videoWidth","height","videoHeight","_setMediaType","reason","mode","type","bitrate","index","label","buffered","JWPLAYER_MEDIA_BUFFER","bufferPercent","checkStaleStream","_getSeekableEnd","end","seekableDuration","_getSeekableStart","seek","_sendMetaEvent","JWPLAYER_MEDIA_META","_textTracks","_sendBufferFull","JWPLAYER_MEDIA_BUFFER_FULL","hasAttribute","removeAttribute","JWPLAYER_PROVIDER_FIRST_FRAME","clearTimeouts","COMPLETE","PAUSED","_stalledHandler","paused","LOADING","ERROR","atEdgeOfLiveStream","checkStreamEnded","JWPLAYER_MEDIA_ERROR","message","_getPublicLevels","levels","publicLevels","typeOf","length","map","i","_setLevels","_pickInitialQuality","JWPLAYER_MEDIA_LEVELS","currentQuality","Math","max","qualityLabel","default","_play","promise","catch","err","isDurationChange","console","warn","_completeLoad","startTime","previousSource","src","sourceElement","file","sourceChanged","loadedSrc","getAttribute","_setVideotagSource","setupSideloadedTracks","_itemTracks","source","preload","_clearVideotagSource","disableTextTrack","emptyElement","style","objectFit","seekable","start","min","stop","clearTracks","destroy","removeTracksListener","_audioTrackChangeHandler","textTrackChangeHandler","remove","off","init","item","sources","sendMediaType","starttime","tracks","once","JWPLAYER_MEDIA_SEEKED","unpausing","isLiveNotDvr","behindLiveEdge","seekPos","e","offset","JWPLAYER_MEDIA_SEEK","volume","vol","between","round","mute","muted","JWPLAYER_MEDIA_COMPLETE","_sendFullscreen","controls","_selectedAudioTrackIndex","enabled","_setCurrentAudioTrack","target","jwstate","detachMedia","attachMedia","loop","enableTextTrack","addTracksListener","setContainer","containerElement","insertBefore","firstChild","getContainer","parentNode","removeChild","setVisibility","visibility","opacity","resize","stretching","playerAspectRatio","videoAspectRatio","abs","fitVideoUsingTransforms","x","floor","y","scaleX","ceil","scaleY","top","left","margin","transform","toFixed","setFullscreen","status","tryCatch","enterFullscreen","webkitEnterFullscreen","webkitEnterFullScreen","apply","Error","getFullScreen","exitFullscreen","webkitExitFullscreen","webkitExitFullScreen","webkitDisplayingFullscreen","setCurrentQuality","quality","JWPLAYER_MEDIA_LEVEL_CHANGED","time","setPlaybackRate","defaultPlaybackRate","getPlaybackRate","getCurrentQuality","getQualityLevels","getName","setCurrentAudioTrack","getAudioTracks","_getAudioTracks","getCurrentAudioTrack","_getCurrentAudioTrack","track","_track","language","currentTrack","mediaType","endOfBuffer","endOfRange","live","timeFudge","F","prototype","qualityLevel","ID3Parser","tracksLoader","tracksHelper","_tracksById","_cuesByTrackId","_cachedVTTCues","_metaCuesByTextTime","_currentTextTrackIndex","_unknownCount","_activeCuePosition","_initTextTracks","clearCueData","getSubtitlesTrack","addTextTracks","setSubtitlesTrack","addTrackHandler","addCuesToTrack","addCaptionsCue","addVTTCue","addVTTCuesToTrack","reject","_id","nativemetadata","len","kind","labelInfo","createLabel","unknownCount","createId","inuse","oncuechange","_cueChangeHandler","bind","_kindSupported","cue","cues","embedded","loaded","shift","_addCueToTrack","_addTrackToList","call","itemTracks","alreadyLoaded","cancelXhr","_clearSideloadedTextTracks","menuIndex","setCurrentSubtitleTrack","each","cueData","text","begin","trackId","trackid","toString","data","cueId","useDTS","vttCue","convertToVTTCues","push","itemTrack","_createTrack","_cacheVTTCue","captions","cuesToConvert","sort","a","b","vttCues","Array","eventType","handler","instreamMode","metadataTrack","_removeCues","inUseTracks","filter","_tracksModified","selectedTextTrackIndex","tracksArray","textTrackAny","loadFile","textTrack","TextTrackCue","addCue","textTrackCue","endTime","test","removeCue","findWhere","addTextTrack","nonSideloadedTracks","groupid","activeCues","currentTarget","dataCues","metadataTime","metadata","JSON","parse","id3Data","parseID3","trackKind","cachedCues","cacheKeyTime","cacheLine","line","cacheValue","cueExists","Uint8Array","join","log","timeRanges"],"mappings":"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","file":"provider.html5.js","sourcesContent":["import { qualityLevel } from 'providers/data-normalizer';\n\ndefine([\n    'providers/html5-android-hls',\n    'utils/css',\n    'utils/helpers',\n    'utils/dom',\n    'utils/underscore',\n    'events/events',\n    'events/states',\n    'providers/default',\n    'utils/backbone.events',\n    'providers/tracks-mixin',\n    'utils/time-ranges',\n], function(getIsAndroidHLS, cssUtils, utils, dom, _, events, states, DefaultProvider, Events, Tracks, timeRangesUtil) {\n\n    var clearTimeout = window.clearTimeout;\n    var STALL_DELAY = 256;\n    var MIN_DVR_DURATION = 120;\n    var _isIE = utils.isIE();\n    var _isIE9 = utils.isIE(9);\n    var _isMobile = utils.isMobile();\n    var _isFirefox = utils.isFF();\n    var _isAndroid = utils.isAndroidNative();\n    var _isIOS7 = utils.isIOS(7);\n    var _isIOS8 = utils.isIOS(8);\n    var _name = 'html5';\n\n    function _setupListeners(eventsHash, videoTag) {\n        utils.foreach(eventsHash, function(evt, evtCallback) {\n            videoTag.addEventListener(evt, evtCallback, false);\n        });\n    }\n\n    function _removeListeners(eventsHash, videoTag) {\n        utils.foreach(eventsHash, function(evt, evtCallback) {\n            videoTag.removeEventListener(evt, evtCallback, false);\n        });\n    }\n\n    function VideoProvider(_playerId, _playerConfig) {\n        // Current media state\n        this.state = states.IDLE;\n\n        // Are we buffering due to seek, or due to playback?\n        this.seeking = false;\n\n        _.extend(this, Events, Tracks);\n\n        this.renderNatively = renderNatively(_playerConfig.renderCaptionsNatively);\n\n        // Always render natively in iOS, Safari and Edge, where HLS is supported.\n        // Otherwise, use native rendering when set in the config for browsers that have adequate support.\n        // FF and IE are excluded due to styling/positioning drawbacks.\n        function renderNatively (configRenderNatively) {\n            if (utils.isIOS() || utils.isSafari() || utils.isEdge()) {\n                return true;\n            }\n            return configRenderNatively && utils.isChrome();\n        }\n\n        var _this = this;\n        var _mediaEvents = {\n            click: _clickHandler,\n            durationchange: _durationChangeHandler,\n            ended: _endedHandler,\n            error: _errorHandler,\n            loadstart: _onLoadStart,\n            loadeddata: _onLoadedData, // we have video tracks (text, audio, metadata)\n            loadedmetadata: _loadedMetadataHandler, // we have video dimensions\n            canplay: _canPlayHandler,\n            play: _loading,\n            playing: _playingHandler,\n            progress: _progressHandler,\n            pause: _pauseHandler,\n            seeking: _seekingHandler,\n            seeked: _seekedHandler,\n            timeupdate: _timeUpdateHandler,\n            ratechange: _playbackRateHandler,\n            volumechange: _volumeChangeHandler,\n            webkitbeginfullscreen: _fullscreenBeginHandler,\n            webkitendfullscreen: _fullscreenEndHandler\n        };\n        var _container;\n        var _duration;\n        var _position;\n        var _canSeek = false;\n        var _bufferFull;\n        var _delayedSeek = 0;\n        var _seekOffset = null;\n        var _playbackTimeout = -1;\n        var _buffered = -1;\n        var _levels;\n        var _currentQuality = -1;\n        var _isAndroidHLS = null;\n        var _isSDK = !!_playerConfig.sdkplatform;\n        var _fullscreenState = false;\n        var _beforeResumeHandler = utils.noop;\n        var _audioTracks = null;\n        var _currentAudioTrackIndex = -1;\n        var _visualQuality = { level: {} };\n\n        var _staleStreamDuration = 3 * 10 * 1000;\n        var _staleStreamTimeout = null;\n        var _lastEndOfBuffer = null;\n        var _stale = false;\n        var _edgeOfLiveStream = false;\n\n        // Find video tag, or create it if it doesn't exist.  View may not be built yet.\n        var element = document.getElementById(_playerId);\n        var _videotag = (element) ? element.querySelector('video, audio') : undefined;\n\n        function _setAttribute(name, value) {\n            _videotag.setAttribute(name, value || '');\n        }\n\n        if (!_videotag) {\n            _videotag = document.createElement('video');\n            _videotag.load();\n\n            if (_isMobile) {\n                _setAttribute('jw-gesture-required');\n            }\n        }\n\n        _videotag.className = 'jw-video jw-reset';\n\n        this.isSDK = _isSDK;\n        this.video = _videotag;\n        this.supportsPlaybackRate = true;\n\n        _setupListeners(_mediaEvents, _videotag);\n\n        _setAttribute('disableRemotePlayback', '');\n        _setAttribute('webkit-playsinline');\n        _setAttribute('playsinline');\n\n        // Enable tracks support for HLS videos\n        function _onLoadedData() {\n            _setAudioTracks(_videotag.audioTracks);\n            _this.setTextTracks(_videotag.textTracks);\n            _setAttribute('jw-loaded', 'data');\n        }\n\n        function _onLoadStart() {\n            _setAttribute('jw-loaded', 'started');\n        }\n\n        function _clickHandler(evt) {\n            _this.trigger('click', evt);\n        }\n\n        function _durationChangeHandler() {\n            if (_isAndroidHLS) {\n                return;\n            }\n            _updateDuration(_getDuration());\n            _setBuffered(_getBuffer(), _position, _duration);\n        }\n\n        function _progressHandler() {\n            _setBuffered(_getBuffer(), _position, _duration);\n        }\n\n        function _timeUpdateHandler() {\n            clearTimeout(_playbackTimeout);\n\n            _canSeek = true;\n            if (_this.state === states.STALLED) {\n                _this.setState(states.PLAYING);\n            } else if (_this.state === states.PLAYING) {\n                _playbackTimeout = setTimeout(_checkPlaybackStalled, STALL_DELAY);\n            }\n            // When video has not yet started playing for androidHLS, we cannot get the correct duration\n            if (_isAndroidHLS && (_videotag.duration === Infinity) && (_videotag.currentTime === 0)) {\n                return;\n            }\n            _updateDuration(_getDuration());\n            _setPosition(_videotag.currentTime);\n            // buffer ranges change during playback, not just on file progress\n            _setBuffered(_getBuffer(), _position, _duration);\n\n            // send time events when playing\n            if (_this.state === states.PLAYING) {\n                _this.trigger(events.JWPLAYER_MEDIA_TIME, {\n                    position: _position,\n                    duration: _duration\n                });\n\n                _checkVisualQuality();\n            }\n        }\n\n        function _playbackRateHandler() {\n            _this.trigger('ratechange', { playbackRate: _videotag.playbackRate });\n        }\n\n        function _checkVisualQuality() {\n            var level = _visualQuality.level;\n            if (level.width !== _videotag.videoWidth ||\n                level.height !== _videotag.videoHeight) {\n                level.width = _videotag.videoWidth;\n                level.height = _videotag.videoHeight;\n                _setMediaType();\n                if (!level.width || !level.height || _currentQuality === -1) {\n                    return;\n                }\n                _visualQuality.reason = _visualQuality.reason || 'auto';\n                _visualQuality.mode = _levels[_currentQuality].type === 'hls' ? 'auto' : 'manual';\n                _visualQuality.bitrate = 0;\n                level.index = _currentQuality;\n                level.label = _levels[_currentQuality].label;\n                _this.trigger('visualQuality', _visualQuality);\n                _visualQuality.reason = '';\n            }\n        }\n\n        function _setBuffered(buffered, currentTime, duration) {\n            if (duration !== 0 && (buffered !== _buffered || duration !== _duration)) {\n                _buffered = buffered;\n                _this.trigger(events.JWPLAYER_MEDIA_BUFFER, {\n                    bufferPercent: buffered * 100,\n                    position: currentTime,\n                    duration: duration\n                });\n            }\n\n            checkStaleStream();\n        }\n\n        function _setPosition(currentTime) {\n            if (_duration < 0) {\n                currentTime = -(_getSeekableEnd() - currentTime);\n            }\n            _position = currentTime;\n        }\n\n        function _getDuration() {\n            var duration = _videotag.duration;\n            var end = _getSeekableEnd();\n            if (duration === Infinity && end) {\n                var seekableDuration = end - _getSeekableStart();\n                if (seekableDuration !== Infinity && seekableDuration > MIN_DVR_DURATION) {\n                    // Player interprets negative duration as DVR\n                    duration = -seekableDuration;\n                }\n            }\n            return duration;\n        }\n\n        function _updateDuration(duration) {\n            _duration = duration;\n            // Don't seek when _delayedSeek is set to -1 in _completeLoad\n            if (_delayedSeek && _delayedSeek !== -1 && duration && duration !== Infinity) {\n                _this.seek(_delayedSeek);\n            }\n        }\n\n        function _sendMetaEvent() {\n            var duration = _getDuration();\n            if (_isAndroidHLS && duration === Infinity) {\n                duration = 0;\n            }\n            _this.trigger(events.JWPLAYER_MEDIA_META, {\n                duration: duration,\n                height: _videotag.videoHeight,\n                width: _videotag.videoWidth\n            });\n            _updateDuration(duration);\n        }\n\n        function _canPlayHandler() {\n            _canSeek = true;\n            if (!_isAndroidHLS) {\n                _setMediaType();\n            }\n            if (_isIE9) {\n                // In IE9, set tracks here since they are not ready\n                // on load\n                _this.setTextTracks(_this._textTracks);\n            }\n            _sendBufferFull();\n        }\n\n        function _loadedMetadataHandler() {\n            _setAttribute('jw-loaded', 'meta');\n            _sendMetaEvent();\n        }\n\n        function _sendBufferFull() {\n            // Wait until the canplay event on iOS to send the bufferFull event\n            if (!_bufferFull) {\n                _bufferFull = true;\n                _this.trigger(events.JWPLAYER_MEDIA_BUFFER_FULL);\n            }\n        }\n\n        function _playingHandler() {\n            _this.setState(states.PLAYING);\n            if (!_videotag.hasAttribute('jw-played')) {\n                _setAttribute('jw-played', '');\n            }\n            if (_videotag.hasAttribute('jw-gesture-required')) {\n                _videotag.removeAttribute('jw-gesture-required');\n            }\n            _this.trigger(events.JWPLAYER_PROVIDER_FIRST_FRAME, {});\n        }\n\n        function _pauseHandler() {\n            clearTimeouts();\n\n            // Sometimes the browser will fire \"complete\" and then a \"pause\" event\n            if (_this.state === states.COMPLETE) {\n                return;\n            }\n\n            // If \"pause\" fires before \"complete\" or before we've started playback, we still don't want to propagate it\n            if (!_videotag.hasAttribute('jw-played') || _videotag.currentTime === _videotag.duration) {\n                return;\n            }\n\n            _this.setState(states.PAUSED);\n        }\n\n        function _stalledHandler() {\n            // Android HLS doesnt update its times correctly so it always falls in here.  Do not allow it to stall.\n            if (_isAndroidHLS) {\n                return;\n            }\n\n            if (_videotag.paused || _videotag.ended) {\n                return;\n            }\n\n            // A stall after loading/error, should just stay loading/error\n            if (_this.state === states.LOADING || _this.state === states.ERROR) {\n                return;\n            }\n\n            // During seek we stay in paused state\n            if (_this.seeking) {\n                return;\n            }\n\n            // Workaround for iOS not completing after midroll with HLS streams\n            if (utils.isIOS() && (_videotag.duration - _videotag.currentTime <= 0.1)) {\n                _endedHandler();\n                return;\n            }\n\n            if (atEdgeOfLiveStream()) {\n                _edgeOfLiveStream = true;\n                if (checkStreamEnded()) {\n                    return;\n                }\n            }\n\n            _this.setState(states.STALLED);\n        }\n\n        function _errorHandler() {\n            _this.trigger(events.JWPLAYER_MEDIA_ERROR, {\n                message: 'Error loading media: File could not be played'\n            });\n        }\n\n        function _getPublicLevels(levels) {\n            var publicLevels;\n            if (utils.typeOf(levels) === 'array' && levels.length > 0) {\n                publicLevels = _.map(levels, function(level, i) {\n                    return {\n                        label: level.label || i\n                    };\n                });\n            }\n            return publicLevels;\n        }\n\n        function _setLevels(levels) {\n            _levels = levels;\n            _currentQuality = _pickInitialQuality(levels);\n            var publicLevels = _getPublicLevels(levels);\n            if (publicLevels) {\n                // _trigger?\n                _this.trigger(events.JWPLAYER_MEDIA_LEVELS, {\n                    levels: publicLevels,\n                    currentQuality: _currentQuality\n                });\n            }\n        }\n\n        function _pickInitialQuality(levels) {\n            var currentQuality = Math.max(0, _currentQuality);\n            var label = _playerConfig.qualityLabel;\n            if (levels) {\n                for (var i = 0; i < levels.length; i++) {\n                    if (levels[i].default) {\n                        currentQuality = i;\n                    }\n                    if (label && levels[i].label === label) {\n                        return i;\n                    }\n                }\n            }\n            _visualQuality.reason = 'initial choice';\n            _visualQuality.level = {};\n            return currentQuality;\n        }\n\n        function _play() {\n            var promise = _videotag.play();\n            if (promise && promise.catch) {\n                promise.catch(function(err) {\n                    if (_videotag.paused) {\n                        // Send a time update to update ads UI\n                        // `isDurationChange` prevents this from propigating an \"adTime\" event\n                        _this.trigger(events.JWPLAYER_MEDIA_TIME, {\n                            position: _position,\n                            duration: _duration,\n                            isDurationChange: true\n                        });\n                        _this.setState(states.PAUSED);\n                    }\n                    // User gesture required to start playback\n                    if (err.name === 'NotAllowedError') {\n                        console.warn(err);\n                        if (_videotag.hasAttribute('jw-gesture-required')) {\n                            _this.trigger('autoplayFailed');\n                        }\n                    }\n                });\n            } else if (_videotag.hasAttribute('jw-gesture-required')) {\n                // Autoplay isn't supported in older versions of Safari (<10) and Chrome (<53)\n                _this.trigger('autoplayFailed');\n            }\n        }\n\n        function _completeLoad(startTime, duration) {\n            _delayedSeek = 0;\n            clearTimeouts();\n\n            var previousSource = _videotag.src;\n            var sourceElement = document.createElement('source');\n            sourceElement.src = _levels[_currentQuality].file;\n            var sourceChanged = (previousSource !== sourceElement.src);\n\n            var loadedSrc = _videotag.getAttribute('jw-loaded');\n\n            if (sourceChanged || loadedSrc === 'none' || loadedSrc === 'started') {\n                _duration = duration;\n                _setVideotagSource(_levels[_currentQuality]);\n                _this.setupSideloadedTracks(_this._itemTracks);\n                if (previousSource && sourceChanged) {\n                    _videotag.load();\n                }\n            } else {\n                // Load event is from the same video as before\n                if (startTime === 0 && _videotag.currentTime > 0) {\n                    // restart video without dispatching seek event\n                    _delayedSeek = -1;\n                    _this.seek(startTime);\n                }\n            }\n\n            _position = _videotag.currentTime;\n\n            if (startTime > 0) {\n                _this.seek(startTime);\n            }\n\n            _play();\n        }\n\n        function _setVideotagSource(source) {\n            _audioTracks = null;\n            _currentAudioTrackIndex = -1;\n            if (!_visualQuality.reason) {\n                _visualQuality.reason = 'initial choice';\n                _visualQuality.level = {};\n            }\n            _canSeek = false;\n            _bufferFull = false;\n            _isAndroidHLS = getIsAndroidHLS(source);\n            if (_isAndroidHLS) {\n                // Playback rate is broken on Android HLS\n                _this.supportsPlaybackRate = false;\n            }\n            if (source.preload && source.preload !== 'none' && source.preload !== _videotag.getAttribute('preload')) {\n                _setAttribute('preload', source.preload);\n            }\n\n            var sourceElement = document.createElement('source');\n            sourceElement.src = source.file;\n            var sourceChanged = (_videotag.src !== sourceElement.src);\n            if (sourceChanged) {\n                _setAttribute('jw-loaded', 'none');\n                _videotag.src = source.file;\n            }\n        }\n\n        function _clearVideotagSource() {\n            if (_videotag) {\n                _this.disableTextTrack();\n                _videotag.removeAttribute('preload');\n                _videotag.removeAttribute('src');\n                _videotag.removeAttribute('jw-loaded');\n                _videotag.removeAttribute('jw-played');\n                _videotag.pause();\n                dom.emptyElement(_videotag);\n                cssUtils.style(_videotag, {\n                    objectFit: ''\n                });\n                _currentQuality = -1;\n            }\n        }\n\n        function _getSeekableStart() {\n            var index = _videotag.seekable ? _videotag.seekable.length : 0;\n            var start = Infinity;\n\n            while (index--) {\n                start = Math.min(start, _videotag.seekable.start(index));\n            }\n            return start;\n        }\n\n        function _getSeekableEnd() {\n            var index = _videotag.seekable ? _videotag.seekable.length : 0;\n            var end = 0;\n\n            while (index--) {\n                end = Math.max(end, _videotag.seekable.end(index));\n            }\n            return end;\n        }\n\n        function _loading() {\n            _this.setState(states.LOADING);\n        }\n\n        this.stop = function() {\n            clearTimeouts();\n            _clearVideotagSource();\n            this.clearTracks();\n            // IE/Edge continue to play a video after changing video.src and calling video.load()\n            // https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/5383483/ (not fixed in Edge 14)\n            if (utils.isIE()) {\n                _videotag.pause();\n            }\n            this.setState(states.IDLE);\n        };\n\n\n        this.destroy = function() {\n            _beforeResumeHandler = utils.noop;\n            _removeListeners(_mediaEvents, _videotag);\n            this.removeTracksListener(_videotag.audioTracks, 'change', _audioTrackChangeHandler);\n            this.removeTracksListener(_videotag.textTracks, 'change', _this.textTrackChangeHandler);\n            this.remove();\n            this.off();\n        };\n\n        this.init = function(item) {\n            _levels = item.sources;\n            _currentQuality = _pickInitialQuality(item.sources);\n            // the loadeddata event determines the mediaType for HLS sources\n            if (item.sources.length && item.sources[0].type !== 'hls') {\n                this.sendMediaType(item.sources);\n            }\n\n            _position = item.starttime || 0;\n            _duration = item.duration || 0;\n            _visualQuality.reason = '';\n\n            var source = _levels[_currentQuality];\n            if (source.preload !== 'none') {\n                _setVideotagSource(source);\n            }\n\n            this.setupSideloadedTracks(item.tracks);\n        };\n\n        this.load = function(item) {\n            _setLevels(item.sources);\n\n            if (item.sources.length && item.sources[0].type !== 'hls') {\n                this.sendMediaType(item.sources);\n            }\n            if (!_isMobile || _videotag.hasAttribute('jw-played')) {\n                // don't change state on mobile before user initiates playback\n                _loading();\n            }\n            _completeLoad(item.starttime || 0, item.duration || 0);\n        };\n\n        this.play = function() {\n            if (_this.seeking) {\n                _loading();\n                _this.once(events.JWPLAYER_MEDIA_SEEKED, _this.play);\n                return;\n            }\n            _beforeResumeHandler();\n            _play();\n        };\n\n        this.pause = function() {\n            clearTimeouts();\n            _videotag.pause();\n            _beforeResumeHandler = function() {\n                var unpausing = _videotag.paused && _videotag.currentTime;\n                if (unpausing && _videotag.duration === Infinity) {\n                    var end = _getSeekableEnd();\n                    var seekableDuration = end - _getSeekableStart();\n                    var isLiveNotDvr = seekableDuration < MIN_DVR_DURATION;\n                    var behindLiveEdge = end - _videotag.currentTime;\n                    if (isLiveNotDvr && end && (behindLiveEdge > 15 || behindLiveEdge < 0)) {\n                        // resume playback at edge of live stream\n                        _seekOffset = Math.max(end - 10, end - seekableDuration);\n                        _setPosition(_videotag.currentTime);\n                        _videotag.currentTime = _seekOffset;\n                    }\n\n                }\n            };\n            this.setState(states.PAUSED);\n        };\n\n        this.seek = function(seekPos) {\n            if (seekPos < 0) {\n                seekPos += _getSeekableStart() + _getSeekableEnd();\n            }\n\n            if (!_canSeek) {\n                _canSeek = !!_getSeekableEnd();\n            }\n            if (_canSeek) {\n                _delayedSeek = 0;\n                // setting currentTime can throw an invalid DOM state exception if the video is not ready\n                try {\n                    _this.seeking = true;\n                    _seekOffset = seekPos;\n                    _setPosition(_videotag.currentTime);\n                    _videotag.currentTime = seekPos;\n                } catch (e) {\n                    _this.seeking = false;\n                    _delayedSeek = seekPos;\n                }\n            } else {\n                _delayedSeek = seekPos;\n                // Firefox isn't firing canplay event when in a paused state\n                // https://bugzilla.mozilla.org/show_bug.cgi?id=1194624\n                if (_isFirefox && _videotag.paused) {\n                    _play();\n                }\n            }\n        };\n\n        function _seekingHandler() {\n            var offset = _seekOffset !== null ? _seekOffset : _videotag.currentTime;\n            _seekOffset = null;\n            _delayedSeek = 0;\n            _this.seeking = true;\n            _this.trigger(events.JWPLAYER_MEDIA_SEEK, {\n                position: _position,\n                offset: offset\n            });\n        }\n\n        function _seekedHandler() {\n            _this.seeking = false;\n            _this.trigger(events.JWPLAYER_MEDIA_SEEKED);\n        }\n\n        this.volume = function(vol) {\n            // volume must be 0.0 - 1.0\n            vol = utils.between(vol / 100, 0, 1);\n\n            _videotag.volume = vol;\n        };\n\n        function _volumeChangeHandler() {\n            _this.trigger('volume', {\n                volume: Math.round(_videotag.volume * 100)\n            });\n            _this.trigger('mute', {\n                mute: _videotag.muted\n            });\n        }\n\n        this.mute = function(state) {\n            _videotag.muted = !!state;\n        };\n\n        function _checkPlaybackStalled() {\n            // Browsers, including latest chrome, do not always report Stalled events in a timely fashion\n            if (_videotag.currentTime === _position) {\n                _stalledHandler();\n            } else {\n                _edgeOfLiveStream = false;\n            }\n        }\n\n        function _getBuffer() {\n            var buffered = _videotag.buffered;\n            var duration = _videotag.duration;\n            if (!buffered || buffered.length === 0 || duration <= 0 || duration === Infinity) {\n                return 0;\n            }\n            return utils.between(buffered.end(buffered.length - 1) / duration, 0, 1);\n        }\n\n        function _endedHandler() {\n            if (_this.state !== states.IDLE && _this.state !== states.COMPLETE) {\n                clearTimeouts();\n                _currentQuality = -1;\n\n                _this.trigger(events.JWPLAYER_MEDIA_COMPLETE);\n            }\n        }\n\n        function _fullscreenBeginHandler(e) {\n            _fullscreenState = true;\n            _sendFullscreen(e);\n            // show controls on begin fullscreen so that they are disabled properly at end\n            if (utils.isIOS()) {\n                _videotag.controls = false;\n            }\n        }\n\n        function _audioTrackChangeHandler() {\n            var _selectedAudioTrackIndex = -1;\n            for (var i = 0; i < _videotag.audioTracks.length; i++) {\n                if (_videotag.audioTracks[i].enabled) {\n                    _selectedAudioTrackIndex = i;\n                    break;\n                }\n            }\n            _setCurrentAudioTrack(_selectedAudioTrackIndex);\n        }\n\n        function _fullscreenEndHandler(e) {\n            _fullscreenState = false;\n            _sendFullscreen(e);\n            if (utils.isIOS()) {\n                _videotag.controls = false;\n            }\n        }\n\n        function _sendFullscreen(e) {\n            _this.trigger('fullscreenchange', {\n                target: e.target,\n                jwstate: _fullscreenState\n            });\n        }\n\n        /**\n         * Return the video tag and stop listening to events\n         */\n        this.detachMedia = function() {\n            clearTimeouts();\n            _removeListeners(_mediaEvents, _videotag);\n            // Stop listening to track changes so disabling the current track doesn't update the model\n            this.removeTracksListener(_videotag.textTracks, 'change', this.textTrackChangeHandler);\n            // Prevent tracks from showing during ad playback\n            this.disableTextTrack();\n            return _videotag;\n        };\n\n        /**\n         * Begin listening to events again\n         */\n        this.attachMedia = function() {\n            _setupListeners(_mediaEvents, _videotag);\n            _canSeek = false;\n\n            // If we were mid-seek when detached, we want to allow it to resume\n            this.seeking = false;\n\n            // In case the video tag was modified while we shared it\n            _videotag.loop = false;\n\n            // If there was a showing track, re-enable it\n            this.enableTextTrack();\n            if (this.renderNatively) {\n                this.setTextTracks(this.video.textTracks);\n            }\n            this.addTracksListener(_videotag.textTracks, 'change', this.textTrackChangeHandler);\n        };\n\n        this.setContainer = function(containerElement) {\n            _container = containerElement;\n            containerElement.insertBefore(_videotag, containerElement.firstChild);\n        };\n\n        this.getContainer = function() {\n            return _container;\n        };\n\n        this.remove = function() {\n            // stop video silently\n            _clearVideotagSource();\n            clearTimeouts();\n\n            // remove\n            if (_container === _videotag.parentNode) {\n                _container.removeChild(_videotag);\n            }\n        };\n\n        this.setVisibility = function(state) {\n            state = !!state;\n            if (state || _isAndroid) {\n                // Changing visibility to hidden on Android < 4.2 causes\n                // the pause event to be fired. This causes audio files to\n                // become unplayable. Hence the video tag is always kept\n                // visible on Android devices.\n                cssUtils.style(_container, {\n                    visibility: 'visible',\n                    opacity: 1\n                });\n            } else {\n                cssUtils.style(_container, {\n                    visibility: '',\n                    opacity: 0\n                });\n            }\n        };\n\n        this.resize = function(width, height, stretching) {\n            if (!width || !height || !_videotag.videoWidth || !_videotag.videoHeight) {\n                return false;\n            }\n            var style = {\n                objectFit: '',\n                width: '',\n                height: ''\n            };\n            if (stretching === 'uniform') {\n                // snap video to edges when the difference in aspect ratio is less than 9%\n                var playerAspectRatio = width / height;\n                var videoAspectRatio = _videotag.videoWidth / _videotag.videoHeight;\n                if (Math.abs(playerAspectRatio - videoAspectRatio) < 0.09) {\n                    style.objectFit = 'fill';\n                    stretching = 'exactfit';\n                }\n            }\n            // Prior to iOS 9, object-fit worked poorly\n            // object-fit is not implemented in IE or Android Browser in 4.4 and lower\n            // http://caniuse.com/#feat=object-fit\n            // feature detection may work for IE but not for browsers where object-fit works for images only\n            var fitVideoUsingTransforms = _isIE || _isIOS7 || _isIOS8 || (_isAndroid && !_isFirefox);\n            if (fitVideoUsingTransforms) {\n                // Use transforms to center and scale video in container\n                var x = -Math.floor(_videotag.videoWidth / 2 + 1);\n                var y = -Math.floor(_videotag.videoHeight / 2 + 1);\n                var scaleX = Math.ceil(width * 100 / _videotag.videoWidth) / 100;\n                var scaleY = Math.ceil(height * 100 / _videotag.videoHeight) / 100;\n                if (stretching === 'none') {\n                    scaleX = scaleY = 1;\n                } else if (stretching === 'fill') {\n                    scaleX = scaleY = Math.max(scaleX, scaleY);\n                } else if (stretching === 'uniform') {\n                    scaleX = scaleY = Math.min(scaleX, scaleY);\n                }\n                style.width = _videotag.videoWidth;\n                style.height = _videotag.videoHeight;\n                style.top = style.left = '50%';\n                style.margin = 0;\n                cssUtils.transform(_videotag,\n                    'translate(' + x + 'px, ' + y + 'px) scale(' + scaleX.toFixed(2) + ', ' + scaleY.toFixed(2) + ')');\n            }\n            cssUtils.style(_videotag, style);\n            return false;\n        };\n\n        this.setFullscreen = function(state) {\n            state = !!state;\n\n            // This implementation is for iOS and Android WebKit only\n            // This won't get called if the player container can go fullscreen\n            if (state) {\n                var status = utils.tryCatch(function() {\n                    var enterFullscreen =\n                        _videotag.webkitEnterFullscreen ||\n                        _videotag.webkitEnterFullScreen;\n                    if (enterFullscreen) {\n                        enterFullscreen.apply(_videotag);\n                    }\n\n                });\n\n                if (status instanceof utils.Error) {\n                    // object can't go fullscreen\n                    return false;\n                }\n                return _this.getFullScreen();\n            }\n\n            var exitFullscreen =\n                _videotag.webkitExitFullscreen ||\n                _videotag.webkitExitFullScreen;\n            if (exitFullscreen) {\n                exitFullscreen.apply(_videotag);\n            }\n\n            return state;\n        };\n\n        _this.getFullScreen = function() {\n            return _fullscreenState || !!_videotag.webkitDisplayingFullscreen;\n        };\n\n        this.setCurrentQuality = function(quality) {\n            if (_currentQuality === quality) {\n                return;\n            }\n            if (quality >= 0) {\n                if (_levels && _levels.length > quality) {\n                    _currentQuality = quality;\n                    _visualQuality.reason = 'api';\n                    _visualQuality.level = {};\n                    this.trigger(events.JWPLAYER_MEDIA_LEVEL_CHANGED, {\n                        currentQuality: quality,\n                        levels: _getPublicLevels(_levels)\n                    });\n\n                    // The playerConfig is not updated automatically, because it is a clone\n                    // from when the provider was first initialized\n                    _playerConfig.qualityLabel = _levels[quality].label;\n\n                    var time = _videotag.currentTime || 0;\n                    var duration = _videotag.duration || 0;\n                    if (duration <= 0) {\n                        duration = _duration;\n                    }\n                    _loading();\n                    _completeLoad(time, duration);\n                }\n            }\n        };\n\n        this.setPlaybackRate = function(playbackRate) {\n            // Set defaultPlaybackRate so that we do not send ratechange events when setting src\n            _videotag.playbackRate = _videotag.defaultPlaybackRate = playbackRate;\n        };\n\n        this.getPlaybackRate = function() {\n            return _videotag.playbackRate;\n        };\n\n        this.getCurrentQuality = function() {\n            return _currentQuality;\n        };\n\n        this.getQualityLevels = function() {\n            return _.map(_levels, level => qualityLevel(level));\n        };\n\n        this.getName = function() {\n            return { name: _name };\n        };\n        this.setCurrentAudioTrack = _setCurrentAudioTrack;\n\n        this.getAudioTracks = _getAudioTracks;\n\n        this.getCurrentAudioTrack = _getCurrentAudioTrack;\n\n        function _setAudioTracks(tracks) {\n            _audioTracks = null;\n            if (!tracks) {\n                return;\n            }\n            if (tracks.length) {\n                for (var i = 0; i < tracks.length; i++) {\n                    if (tracks[i].enabled) {\n                        _currentAudioTrackIndex = i;\n                        break;\n                    }\n                }\n                if (_currentAudioTrackIndex === -1) {\n                    _currentAudioTrackIndex = 0;\n                    tracks[_currentAudioTrackIndex].enabled = true;\n                }\n                _audioTracks = _.map(tracks, function(track) {\n                    var _track = {\n                        name: track.label || track.language,\n                        language: track.language\n                    };\n                    return _track;\n                });\n            }\n            _this.addTracksListener(tracks, 'change', _audioTrackChangeHandler);\n            if (_audioTracks) {\n                _this.trigger('audioTracks', { currentTrack: _currentAudioTrackIndex, tracks: _audioTracks });\n            }\n        }\n\n        function _setCurrentAudioTrack(index) {\n            if (_videotag && _videotag.audioTracks && _audioTracks &&\n                index > -1 && index < _videotag.audioTracks.length && index !== _currentAudioTrackIndex) {\n                _videotag.audioTracks[_currentAudioTrackIndex].enabled = false;\n                _currentAudioTrackIndex = index;\n                _videotag.audioTracks[_currentAudioTrackIndex].enabled = true;\n                _this.trigger('audioTrackChanged', { currentTrack: _currentAudioTrackIndex,\n                    tracks: _audioTracks });\n            }\n        }\n\n        function _getAudioTracks() {\n            return _audioTracks || [];\n        }\n\n        function _getCurrentAudioTrack() {\n            return _currentAudioTrackIndex;\n        }\n\n        function _setMediaType() {\n            // Send mediaType when format is HLS. Other types are handled earlier by default.js.\n            if (_levels[0].type === 'hls') {\n                var mediaType = 'video';\n                if (_videotag.videoHeight === 0) {\n                    mediaType = 'audio';\n                }\n                _this.trigger('mediaType', { mediaType: mediaType });\n            }\n        }\n\n        // If we're live and the buffer end has remained the same for some time, mark the stream as stale and check if the stream is over\n        function checkStaleStream() {\n            var endOfBuffer = timeRangesUtil.endOfRange(_videotag.buffered);\n            var live = (_videotag.duration === Infinity);\n\n            if (live && _lastEndOfBuffer === endOfBuffer) {\n                if (!_staleStreamTimeout) {\n                    _staleStreamTimeout = setTimeout(function () {\n                        _stale = true;\n                        checkStreamEnded();\n                    }, _staleStreamDuration);\n                }\n            } else {\n                clearTimeout(_staleStreamTimeout);\n                _staleStreamTimeout = null;\n                _stale = false;\n            }\n\n            _lastEndOfBuffer = endOfBuffer;\n        }\n\n        function checkStreamEnded() {\n            if (_stale && _edgeOfLiveStream) {\n                _this.trigger(events.JWPLAYER_MEDIA_ERROR, {\n                    message: 'The live stream is either down or has ended'\n                });\n                return true;\n            }\n\n            return false;\n        }\n\n        function atEdgeOfLiveStream() {\n            if (_videotag.duration !== Infinity) {\n                return false;\n            }\n\n            // currentTime doesn't always get to the end of the buffered range\n            var timeFudge = 2;\n            return (timeRangesUtil.endOfRange(_videotag.buffered)) - _videotag.currentTime <= timeFudge;\n        }\n\n        function clearTimeouts() {\n            clearTimeout(_playbackTimeout);\n            clearTimeout(_staleStreamTimeout);\n            _staleStreamTimeout = null;\n        }\n    }\n\n    // Register provider\n    var F = function() {};\n    F.prototype = DefaultProvider;\n    VideoProvider.prototype = new F();\n\n    VideoProvider.getName = function() {\n        return { name: 'html5' };\n    };\n\n    return VideoProvider;\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/providers/html5.js\n **/","export function qualityLevel(level) {\n    return {\n        bitrate: level.bitrate,\n        label: level.label,\n        width: level.width,\n        height: level.height\n    };\n}\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/providers/data-normalizer.js\n **/","define(['utils/underscore',\n    'utils/id3Parser',\n    'utils/helpers',\n    'controller/tracks-loader',\n    'controller/tracks-helper'\n], function(_, ID3Parser, utils, tracksLoader, tracksHelper) {\n    /**\n     * Used across all providers for loading tracks and handling browser track-related events\n     */\n    var Tracks = {\n        _itemTracks: null,\n        _textTracks: null,\n        _tracksById: null,\n        _cuesByTrackId: null,\n        _cachedVTTCues: null,\n        _metaCuesByTextTime: null,\n        _currentTextTrackIndex: -1,\n        _unknownCount: 0,\n        _activeCuePosition: null,\n        _initTextTracks: _initTextTracks,\n        addTracksListener: addTracksListener,\n        clearTracks: clearTracks,\n        clearCueData: clearCueData,\n        disableTextTrack: disableTextTrack,\n        enableTextTrack: enableTextTrack,\n        getSubtitlesTrack: getSubtitlesTrack,\n        removeTracksListener: removeTracksListener,\n        addTextTracks: addTextTracks,\n        setTextTracks: setTextTracks,\n        setupSideloadedTracks: setupSideloadedTracks,\n        setSubtitlesTrack: setSubtitlesTrack,\n        textTrackChangeHandler: null,\n        addTrackHandler: null,\n        addCuesToTrack: addCuesToTrack,\n        addCaptionsCue: addCaptionsCue,\n        addVTTCue: addVTTCue,\n        addVTTCuesToTrack: addVTTCuesToTrack,\n        renderNatively: false\n    };\n\n    function setTextTracks(tracks) {\n        this._currentTextTrackIndex = -1;\n        if (!tracks) {\n            return;\n        }\n\n        if (!this._textTracks) {\n            this._initTextTracks();\n        } else {\n            // Remove the 608 captions track that was mutated by the browser\n            this._textTracks = _.reject(this._textTracks, function(track) {\n                if ((this.renderNatively && track._id === 'nativecaptions')) {\n                    delete this._tracksById[track._id];\n                    return true;\n                }\n            }, this);\n\n            // Remove the ID3 track from the cache\n            delete this._tracksById.nativemetadata;\n        }\n\n        // filter for 'subtitles' or 'captions' tracks\n        if (tracks.length) {\n            var i = 0;\n            var len = tracks.length;\n\n            for (i; i < len; i++) {\n                var track = tracks[i];\n                if (!track._id) {\n                    if (track.kind === 'captions' || track.kind === 'metadata') {\n                        track._id = 'native' + track.kind;\n                        if (!track.label && track.kind === 'captions') {\n                            // track label is read only in Safari\n                            // 'captions' tracks without a label need a name in order for the cc menu to work\n                            var labelInfo = tracksHelper.createLabel(track, this._unknownCount);\n                            track.name = labelInfo.label;\n                            this._unknownCount = labelInfo.unknownCount;\n                        }\n                    } else {\n                        track._id = tracksHelper.createId(track, this._textTracks.length);\n                    }\n                    if (this._tracksById[track._id]) {\n                        // tracks without unique ids must not be marked as \"inuse\"\n                        continue;\n                    }\n                    track.inuse = true;\n                }\n                if (!track.inuse || this._tracksById[track._id]) {\n                    continue;\n                }\n                // setup TextTrack\n                if (track.kind === 'metadata') {\n                    // track mode needs to be \"hidden\", not \"showing\", so that cues don't display as captions in Firefox\n                    track.mode = 'hidden';\n                    track.oncuechange = _cueChangeHandler.bind(this);\n                    this._tracksById[track._id] = track;\n                } else if (_kindSupported(track.kind)) {\n                    var mode = track.mode;\n                    var cue;\n\n                    // By setting the track mode to 'hidden', we can determine if the track has cues\n                    track.mode = 'hidden';\n\n                    if (!track.cues.length && track.embedded) {\n                        // There's no method to remove tracks added via: video.addTextTrack.\n                        // This ensures the 608 captions track isn't added to the CC menu until it has cues\n                        continue;\n                    }\n\n                    track.mode = mode;\n\n                    // Parsed cues may not have been added to this track yet\n                    if (this._cuesByTrackId[track._id] && !this._cuesByTrackId[track._id].loaded) {\n                        var cues = this._cuesByTrackId[track._id].cues;\n                        while ((cue = cues.shift())) {\n                            _addCueToTrack(this.renderNatively, track, cue);\n                        }\n                        track.mode = mode;\n                        this._cuesByTrackId[track._id].loaded = true;\n                    }\n\n                    _addTrackToList.call(this, track);\n                }\n            }\n        }\n\n        if (this.renderNatively) {\n            // Only bind and set this.textTrackChangeHandler once so that removeEventListener works\n            this.textTrackChangeHandler = this.textTrackChangeHandler || textTrackChangeHandler.bind(this);\n            this.addTracksListener(this.video.textTracks, 'change', this.textTrackChangeHandler);\n\n            if (utils.isEdge() || utils.isFF() || utils.isSafari()) {\n                // Listen for TextTracks added to the videotag after the onloadeddata event in Edge and Firefox\n                this.addTrackHandler = this.addTrackHandler || addTrackHandler.bind(this);\n                this.addTracksListener(this.video.textTracks, 'addtrack', this.addTrackHandler);\n            }\n        }\n\n        if (this._textTracks.length) {\n            this.trigger('subtitlesTracks', { tracks: this._textTracks });\n        }\n    }\n\n    function setupSideloadedTracks(itemTracks) {\n        // Add tracks if we're starting playback or resuming after a midroll\n\n        if (!this.renderNatively) {\n            return;\n        }\n        // Determine if the tracks are the same and the embedded + sideloaded count = # of tracks in the controlbar\n        var alreadyLoaded = itemTracks === this._itemTracks;\n        if (!alreadyLoaded) {\n            tracksLoader.cancelXhr(this._itemTracks);\n        }\n        this._itemTracks = itemTracks;\n        if (!itemTracks) {\n            return;\n        }\n\n        if (!alreadyLoaded) {\n            this.disableTextTrack();\n            _clearSideloadedTextTracks.call(this);\n            this.addTextTracks(itemTracks);\n        }\n    }\n\n    function getSubtitlesTrack() {\n        return this._currentTextTrackIndex;\n    }\n\n    function setSubtitlesTrack(menuIndex) {\n        if (!this.renderNatively) {\n            if (this.setCurrentSubtitleTrack) {\n                this.setCurrentSubtitleTrack(menuIndex - 1);\n            }\n            return;\n        }\n\n        if (!this._textTracks) {\n            return;\n        }\n\n        // 0 = 'Off'\n        if (menuIndex === 0) {\n            _.each(this._textTracks, function (track) {\n                track.mode = track.embedded ? 'hidden' : 'disabled';\n            });\n        }\n\n        // Track index is 1 less than controlbar index to account for 'Off' = 0.\n        // Prevent unnecessary track change events\n        if (this._currentTextTrackIndex === menuIndex - 1) {\n            return;\n        }\n\n        // Turn off current track\n        this.disableTextTrack();\n\n        // Set the provider's index to the model's index, then show the selected track if it exists\n        this._currentTextTrackIndex = menuIndex - 1;\n\n        if (this._textTracks[this._currentTextTrackIndex]) {\n            this._textTracks[this._currentTextTrackIndex].mode = 'showing';\n        }\n\n        // Update the model index since the track change may have come from a browser event\n        this.trigger('subtitlesTrackChanged', {\n            currentTrack: this._currentTextTrackIndex + 1,\n            tracks: this._textTracks\n        });\n    }\n\n    function addCaptionsCue(cueData) {\n        if (!cueData.text || !cueData.begin || !cueData.end) {\n            return;\n        }\n        var trackId = cueData.trackid.toString();\n        var track = this._tracksById && this._tracksById[trackId];\n        if (!track) {\n            track = {\n                kind: 'captions',\n                _id: trackId,\n                data: []\n            };\n            this.addTextTracks([track]);\n            this.trigger('subtitlesTracks', { tracks: this._textTracks });\n        }\n\n        var cueId;\n\n        if (cueData.useDTS) {\n            // There may not be any 608 captions when the track is first created\n            // Need to set the source so position is determined from metadata\n            if (!track.source) {\n                track.source = cueData.source || 'mpegts';\n            }\n\n        }\n        cueId = cueData.begin + '_' + cueData.text;\n\n        var cue = this._metaCuesByTextTime[cueId];\n        if (!cue) {\n            cue = {\n                begin: cueData.begin,\n                end: cueData.end,\n                text: cueData.text\n            };\n            this._metaCuesByTextTime[cueId] = cue;\n            var vttCue = tracksLoader.convertToVTTCues([cue])[0];\n            track.data.push(vttCue);\n        }\n    }\n\n    function addVTTCue(cueData) {\n        if (!this._tracksById) {\n            this._initTextTracks();\n        }\n\n        var trackId = cueData.track ? cueData.track : 'native' + cueData.type;\n        var track = this._tracksById[trackId];\n        var label = cueData.type === 'captions' ? 'Unknown CC' : 'ID3 Metadata';\n        var vttCue = cueData.cue;\n\n        if (!track) {\n            var itemTrack = {\n                kind: cueData.type,\n                _id: trackId,\n                label: label,\n                embedded: true\n            };\n\n            track = _createTrack.call(this, itemTrack);\n\n            if (this.renderNatively || track.kind === 'metadata') {\n                this.setTextTracks(this.video.textTracks);\n            } else {\n                addTextTracks.call(this, [track]);\n            }\n        }\n        if (_cacheVTTCue.call(this, track, vttCue)) {\n            if (this.renderNatively || track.kind === 'metadata') {\n                _addCueToTrack(this.renderNatively, track, vttCue);\n            } else {\n                track.data.push(vttCue);\n            }\n        }\n    }\n\n    function addCuesToTrack(cueData) {\n        // convert cues coming from the flash provider into VTTCues, then append them to track\n        var track = this._tracksById[cueData.name];\n        if (!track) {\n            return;\n        }\n\n        track.source = cueData.source;\n        var cues = cueData.captions || [];\n        var cuesToConvert = [];\n        var sort = false;\n\n        for (var i = 0; i < cues.length; i++) {\n            var cue = cues[i];\n            var cueId = cueData.name + '_' + cue.begin + '_' + cue.end;\n            if (!this._metaCuesByTextTime[cueId]) {\n                this._metaCuesByTextTime[cueId] = cue;\n                cuesToConvert.push(cue);\n                sort = true;\n            }\n        }\n        if (sort) {\n            cuesToConvert.sort(function(a, b) {\n                return a.begin - b.begin;\n            });\n        }\n        var vttCues = tracksLoader.convertToVTTCues(cuesToConvert);\n        Array.prototype.push.apply(track.data, vttCues);\n    }\n\n    function addTracksListener(tracks, eventType, handler) {\n        if (!tracks) {\n            return;\n        }\n        // Always remove existing listener\n        removeTracksListener(tracks, eventType, handler);\n\n        if (this.instreamMode) {\n            return;\n        }\n\n        if (tracks.addEventListener) {\n            tracks.addEventListener(eventType, handler);\n        } else {\n            tracks['on' + eventType] = handler;\n        }\n    }\n\n    function removeTracksListener(tracks, eventType, handler) {\n        if (!tracks) {\n            return;\n        }\n        if (tracks.removeEventListener) {\n            tracks.removeEventListener(eventType, handler);\n        } else {\n            tracks['on' + eventType] = null;\n        }\n    }\n\n    function clearTracks() {\n        tracksLoader.cancelXhr(this._itemTracks);\n        var metadataTrack = this._tracksById && this._tracksById.nativemetadata;\n        if (this.renderNatively || metadataTrack) {\n            _removeCues(this.renderNatively, this.video.textTracks);\n            if (metadataTrack) {\n                metadataTrack.oncuechange = null;\n            }\n        }\n\n        this._itemTracks = null;\n        this._textTracks = null;\n        this._tracksById = null;\n        this._cuesByTrackId = null;\n        this._metaCuesByTextTime = null;\n        this._unknownCount = 0;\n        this._activeCuePosition = null;\n        if (this.renderNatively) {\n            // Removing listener first to ensure that removing cues does not trigger it unnecessarily\n            this.removeTracksListener(this.video.textTracks, 'change', this.textTrackChangeHandler);\n            _removeCues(this.renderNatively, this.video.textTracks);\n        }\n    }\n\n    // Clear track cues to prevent duplicates\n    function clearCueData(trackId) {\n        if (this._cachedVTTCues[trackId]) {\n            this._cachedVTTCues[trackId] = {};\n            this._tracksById[trackId].data = [];\n        }\n    }\n\n    function disableTextTrack() {\n        if (this._textTracks) {\n            var track = this._textTracks[this._currentTextTrackIndex];\n            if (track) {\n                // FF does not remove the active cue from the dom when the track is hidden, so we must disable it\n                track.mode = 'disabled';\n                if (track.embedded || track._id === 'nativecaptions') {\n                    track.mode = 'hidden';\n                }\n            }\n        }\n    }\n\n    function enableTextTrack() {\n        if (this._textTracks) {\n            var track = this._textTracks[this._currentTextTrackIndex];\n            if (track) {\n                track.mode = 'showing';\n            }\n        }\n    }\n\n    function textTrackChangeHandler() {\n        var textTracks = this.video.textTracks;\n        var inUseTracks = _.filter(textTracks, function (track) {\n            return (track.inuse || !track._id) && _kindSupported(track.kind);\n        });\n        if (!this._textTracks || _tracksModified.call(this, inUseTracks)) {\n            this.setTextTracks(textTracks);\n            return;\n        }\n        // If a caption/subtitle track is showing, find its index\n        var selectedTextTrackIndex = -1;\n        for (var i = 0; i < this._textTracks.length; i++) {\n            if (this._textTracks[i].mode === 'showing') {\n                selectedTextTrackIndex = i;\n                break;\n            }\n        }\n\n        // Notifying the model when the index changes keeps the current index in sync in iOS Fullscreen mode\n        if (selectedTextTrackIndex !== this._currentTextTrackIndex) {\n            this.setSubtitlesTrack(selectedTextTrackIndex + 1);\n        }\n    }\n\n    // Used in MS Edge to get tracks from the videotag as they're added\n    function addTrackHandler() {\n        this.setTextTracks(this.video.textTracks);\n    }\n\n    function addTextTracks(tracksArray) {\n        if (!tracksArray) {\n            return;\n        }\n\n        if (!this._textTracks) {\n            this._initTextTracks();\n        }\n\n        for (var i = 0; i < tracksArray.length; i++) {\n            var itemTrack = tracksArray[i];\n            // only add valid and supported kinds https://developer.mozilla.org/en-US/docs/Web/HTML/Element/track\n            if (itemTrack.kind && !_kindSupported(itemTrack.kind)) {\n                continue;\n            }\n            var textTrackAny = _createTrack.call(this, itemTrack);\n            _addTrackToList.call(this, textTrackAny);\n            if (itemTrack.file) {\n                itemTrack.data = [];\n                tracksLoader.loadFile(itemTrack,\n                    this.addVTTCuesToTrack.bind(this, textTrackAny),\n                    _errorHandler);\n            }\n        }\n\n        if (this._textTracks && this._textTracks.length) {\n            this.trigger('subtitlesTracks', { tracks: this._textTracks });\n        }\n    }\n\n    function addVTTCuesToTrack(track, vttCues) {\n        if (!this.renderNatively) {\n            return;\n        }\n\n        var textTrack = this._tracksById[track._id];\n        // the track may not be on the video tag yet\n        if (!textTrack) {\n\n            if (!this._cuesByTrackId) {\n                this._cuesByTrackId = {};\n            }\n            this._cuesByTrackId[track._id] = { cues: vttCues, loaded: false };\n            return;\n        }\n        // Cues already added\n        if (this._cuesByTrackId[track._id] && this._cuesByTrackId[track._id].loaded) {\n            return;\n        }\n\n        var cue;\n        this._cuesByTrackId[track._id] = { cues: vttCues, loaded: true };\n\n        while ((cue = vttCues.shift())) {\n            _addCueToTrack(this.renderNatively, textTrack, cue);\n        }\n    }\n\n    // ////////////////////\n    // //// PRIVATE METHODS\n    // ////////////////////\n\n    function _addCueToTrack(renderNatively, track, vttCue) {\n        if (!(utils.isIE() && renderNatively) || !window.TextTrackCue) {\n            track.addCue(vttCue);\n            return;\n        }\n        // There's no support for the VTTCue interface in IE/Edge.\n        // We need to convert VTTCue to TextTrackCue before adding them to the TextTrack\n        // This unfortunately removes positioning properties from the cues\n        var textTrackCue = new window.TextTrackCue(vttCue.startTime, vttCue.endTime, vttCue.text);\n        track.addCue(textTrackCue);\n    }\n\n    function _removeCues(renderNatively, tracks) {\n        if (tracks && tracks.length) {\n            _.each(tracks, function(track) {\n                // Let IE & Edge handle cleanup of non-sideloaded text tracks for native rendering\n                if (utils.isIE() && renderNatively && /^(native|subtitle|cc)/.test(track._id)) {\n                    return;\n                }\n                \n                // Cues are inaccessible if the track is disabled. While hidden,\n                // we can remove cues while the track is in a non-visible state\n                // Set to disabled before hidden to ensure active cues disappear\n                track.mode = 'disabled';\n                track.mode = 'hidden';\n                for (var i = track.cues.length; i--;) {\n                    track.removeCue(track.cues[i]);\n                }\n                if (!track.embedded) {\n                    track.mode = 'disabled';\n                }\n                track.inuse = false;\n            });\n        }\n    }\n\n    function _kindSupported(kind) {\n        return kind === 'subtitles' || kind === 'captions';\n    }\n\n    function _initTextTracks() {\n        this._textTracks = [];\n        this._tracksById = {};\n        this._metaCuesByTextTime = {};\n        this._cuesByTrackId = {};\n        this._cachedVTTCues = {};\n        this._unknownCount = 0;\n    }\n\n    function _createTrack(itemTrack) {\n        var track;\n        var labelInfo = tracksHelper.createLabel(itemTrack, this._unknownCount);\n        var label = labelInfo.label;\n        this._unknownCount = labelInfo.unknownCount;\n\n        if (this.renderNatively || itemTrack.kind === 'metadata') {\n            var tracks = this.video.textTracks;\n            // TextTrack label is read only, so we'll need to create a new track if we don't\n            // already have one with the same label\n            track = _.findWhere(tracks, { label: label });\n\n            if (track) {\n                track.kind = itemTrack.kind;\n                track.language = itemTrack.language || '';\n            } else {\n                track = this.video.addTextTrack(itemTrack.kind, label, itemTrack.language || '');\n            }\n\n            track.default = itemTrack.default;\n            track.mode = 'disabled';\n            track.inuse = true;\n        } else {\n            track = itemTrack;\n            track.data = track.data || [];\n        }\n\n        if (!track._id) {\n            track._id = tracksHelper.createId(itemTrack, this._textTracks.length);\n        }\n\n        return track;\n    }\n\n    function _addTrackToList(track) {\n        this._textTracks.push(track);\n        this._tracksById[track._id] = track;\n    }\n\n    function _clearSideloadedTextTracks() {\n        // Clear VTT textTracks\n        if (!this._textTracks) {\n            return;\n        }\n        var nonSideloadedTracks = _.filter(this._textTracks, function (track) {\n            return track.embedded || track.groupid === 'subs';\n        });\n        this._initTextTracks();\n        _.each(nonSideloadedTracks, function (track) {\n            this._tracksById[track._id] = track;\n        });\n        this._textTracks = nonSideloadedTracks;\n    }\n\n    function _cueChangeHandler(e) {\n        var activeCues = e.currentTarget.activeCues;\n        if (!activeCues || !activeCues.length) {\n            return;\n        }\n\n        // Get the most recent start time. Cues are sorted by start time in ascending order by the browser\n        var startTime = activeCues[activeCues.length - 1].startTime;\n        // Prevent duplicate meta events for the same list of cues since the cue change handler fires once\n        // for each activeCue in Safari\n        if (this._activeCuePosition === startTime) {\n            return;\n        }\n        var dataCues = [];\n\n        _.each(activeCues, function(cue) {\n            if (cue.startTime < startTime) {\n                return;\n            }\n            if (cue.data || cue.value) {\n                dataCues.push(cue);\n            } else if (cue.text) {\n                this.trigger('meta', {\n                    metadataTime: startTime,\n                    metadata: JSON.parse(cue.text)\n                });\n            }\n        }, this);\n\n        if (dataCues.length) {\n            var id3Data = ID3Parser.parseID3(dataCues);\n            this.trigger('meta', {\n                metadataTime: startTime,\n                metadata: id3Data\n            });\n        }\n        this._activeCuePosition = startTime;\n    }\n\n    function _cacheVTTCue(track, vttCue) {\n        var trackKind = track.kind;\n        if (!this._cachedVTTCues[track._id]) {\n            this._cachedVTTCues[track._id] = {};\n        }\n        var cachedCues = this._cachedVTTCues[track._id];\n        var cacheKeyTime;\n\n        switch (trackKind) {\n            case 'captions':\n            case 'subtitles':\n                // VTTCues should have unique start and end times, even in cases where there are multiple\n                // active cues. This is safer than ensuring text is unique, which may be violated on seek.\n                // Captions within .05s of each other are treated as unique to account for\n                // quality switches where start/end times are slightly different.\n                cacheKeyTime = Math.floor(vttCue.startTime * 20);\n                var cacheLine = '_' + vttCue.line;\n                var cacheValue = Math.floor(vttCue.endTime * 20);\n                var cueExists = cachedCues[cacheKeyTime + cacheLine] || cachedCues[(cacheKeyTime + 1) + cacheLine] || cachedCues[(cacheKeyTime - 1) + cacheLine];\n\n                if (cueExists && Math.abs(cueExists - cacheValue) <= 1) {\n                    return false;\n                }\n\n                cachedCues[cacheKeyTime + cacheLine] = cacheValue;\n                return true;\n            case 'metadata':\n                var text = vttCue.data ? new Uint8Array(vttCue.data).join('') : vttCue.text;\n                cacheKeyTime = vttCue.startTime + text;\n                if (cachedCues[cacheKeyTime]) {\n                    return false;\n                }\n\n                cachedCues[cacheKeyTime] = vttCue.endTime;\n                return true;\n            default:\n                return false;\n        }\n    }\n\n    function _tracksModified(inUseTracks) {\n        // Need to add new textTracks coming from the video tag\n        if (inUseTracks.length > this._textTracks.length) {\n            return true;\n        }\n\n        // Tracks may have changed in Safari after an ad\n        for (var i = 0; i < inUseTracks.length; i++) {\n            var track = inUseTracks[i];\n            if (!track._id || !this._tracksById[track._id]) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n\n    function _errorHandler(error) {\n        utils.log('CAPTIONS(' + error + ')');\n    }\n\n    return Tracks;\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/providers/tracks-mixin.js\n **/","define([\n\n], function () {\n    function endOfRange(timeRanges) {\n        if (!timeRanges || !timeRanges.length) {\n            return 0;\n        }\n\n        return timeRanges.end(timeRanges.length - 1);\n    }\n\n    return {\n        endOfRange: endOfRange,\n    };\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/utils/time-ranges.js\n **/"],"sourceRoot":""}